{"version":3,"file":"recommender.min.js","sources":["../src/recommender.js"],"sourcesContent":["/**\n * Course recommender AMD module.\n *\n * @module     block_course_recommender/recommender\n * @copyright  2025 Sadik Mert\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n\n    /**\n     * Initialize the module.\n     */\n    function init() {\n        var form = $('#courserecommender-form');\n        var resultsContainer = $('.courserecommender-results');\n\n        if (!form.length || !resultsContainer.length) {\n            return;\n        }\n\n        // Badge-Auswahl-Logik\n        form.on('click', '.courserecommender-badge', function(e) {\n            e.preventDefault();\n            $(this).toggleClass('selected');\n            updateSelectedTags(form);\n            clearTimeout(window.changeTimeout);\n            window.changeTimeout = setTimeout(function() {\n                form.submit();\n            }, 300);\n        });\n\n        // Handle form submission\n        form.on('submit', function(e) {\n            e.preventDefault();\n            updateResults(form, resultsContainer);\n        });\n    }\n\n    /**\n     * Update the hidden input with selected tags.\n     * @param {jQuery} form The form element\n     */\n    function updateSelectedTags(form) {\n        var selected = [];\n        form.find('.courserecommender-badge.selected').each(function() {\n            selected.push($(this).data('tag'));\n        });\n        form.find('#courserecommender-selected-tags').val(selected.join(','));\n    }\n\n    /**\n     * Update results using AJAX.\n     *\n     * @param {jQuery} form The form element\n     * @param {jQuery} resultsContainer The results container element\n     */\n    function updateResults(form, resultsContainer) {\n        // Show loading indicator\n        resultsContainer.html('<div class=\"text-center\"><span class=\"spinner-border\"></span></div>');\n\n        // Get selected interests from hidden input\n        var interests = form.find('#courserecommender-selected-tags').val();\n        interests = interests ? interests.split(',') : [];\n\n        // Prepare request\n        var request = {\n            methodname: 'block_course_recommender_get_courses',\n            args: {\n                interests: interests,\n                sesskey: M.cfg.sesskey\n            }\n        };\n\n        // Make AJAX call\n        Ajax.call([request])[0]\n            .done(function(response) {\n                resultsContainer.fadeOut(200, function() {\n                    $(this).html(response.html).fadeIn(200);\n                });\n            })\n            .fail(function(error) {\n                Notification.exception(error);\n                handleAjaxError(resultsContainer);\n            });\n    }\n\n    /**\n     * Handles AJAX error and displays a localized error message.\n     * @param {jQuery} resultsContainer The results container element\n     */\n    function handleAjaxError(resultsContainer) {\n        Str.get_string('error', 'block_course_recommender')\n            .then(function(errorStr) {\n                resultsContainer.html('<div class=\"alert alert-danger\">' + errorStr + '</div>');\n                return null;\n            })\n            .catch(function() {\n                resultsContainer.html('<div class=\"alert alert-danger\">Error</div>');\n                return null;\n            });\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","init","form","resultsContainer","length","on","e","preventDefault","this","toggleClass","selected","find","each","push","data","val","join","updateSelectedTags","clearTimeout","window","changeTimeout","setTimeout","submit","html","interests","request","methodname","args","split","sesskey","M","cfg","call","done","response","fadeOut","fadeIn","fail","error","exception","get_string","then","errorStr","catch","handleAjaxError","updateResults"],"mappings":";;;;;;;AAOAA,8CAAO,CAAC,SAAU,YAAa,oBAAqB,aAAa,SAASC,EAAGC,KAAMC,aAAcC,WA+FtF,CACHC,oBA1FIC,KAAOL,EAAE,2BACTM,iBAAmBN,EAAE,8BAEpBK,KAAKE,QAAWD,iBAAiBC,SAKtCF,KAAKG,GAAG,QAAS,4BAA4B,SAASC,GAClDA,EAAEC,iBACFV,EAAEW,MAAMC,YAAY,qBAmBAP,UACpBQ,SAAW,GACfR,KAAKS,KAAK,qCAAqCC,MAAK,WAChDF,SAASG,KAAKhB,EAAEW,MAAMM,KAAK,WAE/BZ,KAAKS,KAAK,oCAAoCI,IAAIL,SAASM,KAAK,MAvB5DC,CAAmBf,MACnBgB,aAAaC,OAAOC,eACpBD,OAAOC,cAAgBC,YAAW,WAC9BnB,KAAKoB,WACN,QAIPpB,KAAKG,GAAG,UAAU,SAASC,GACvBA,EAAEC,0BAuBaL,KAAMC,kBAEzBA,iBAAiBoB,KAAK,2EAGlBC,UAAYtB,KAAKS,KAAK,oCAAoCI,MAI1DU,QAAU,CACVC,WAAY,uCACZC,KAAM,CACFH,UANRA,UAAYA,UAAYA,UAAUI,MAAM,KAAO,GAOvCC,QAASC,EAAEC,IAAIF,UAKvB/B,KAAKkC,KAAK,CAACP,UAAU,GAChBQ,MAAK,SAASC,UACX/B,iBAAiBgC,QAAQ,KAAK,WAC1BtC,EAAEW,MAAMe,KAAKW,SAASX,MAAMa,OAAO,WAG1CC,MAAK,SAASC,OACXvC,aAAawC,UAAUD,gBASVnC,kBACrBH,IAAIwC,WAAW,QAAS,4BACnBC,MAAK,SAASC,iBACXvC,iBAAiBoB,KAAK,mCAAqCmB,SAAW,UAC/D,QAEVC,OAAM,kBACHxC,iBAAiBoB,KAAK,+CACf,QAhBPqB,CAAgBzC,qBAhDpB0C,CAAc3C,KAAMC"}